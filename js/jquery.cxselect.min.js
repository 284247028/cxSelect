/*!
 * cxSelect 1.3
 * http://code.ciaoca.com/
 * https://github.com/ciaoca/cxSelect
 * E-mail: ciaoca@gmail.com
 * Released under the MIT license
 * Date: 2013-04-05
 */
!function(a){a.fn.cxSelect=function(b){var c={settings:a.extend({},a.cxSelect.defaults,b),dom:{box:this}};c.init=function(){var c,b=this;if(b.dom.box.length&&b.settings.selects.length){for(b.selectArray=[],b.selectSum=b.settings.selects.length,c=0;c<b.selectSum&&b.dom.box.find("select."+b.settings.selects[c]);c++)b.selectArray.push(b.dom.box.find("select."+b.settings.selects[c]));b.selectSum=b.selectArray.length,b.selectSum&&("string"==typeof b.settings.url?a.getJSON(b.settings.url,function(a){b.dataJson=a,b.buildContent()}):"object"==typeof b.settings.url&&(b.dataJson=b.settings.url,b.buildContent()))}},c.isArray=function(a){return"function"==typeof Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},c.getIndex=function(a){return this.settings.required?a:a-1},c.getNewOptions=function(b,c){c=c||this.settings.title;var d;return this.settings.required||(d='<option value="0">'+c+"</option>"),a.each(b,function(a,b){d+="string"==typeof b.v||"number"==typeof b.v?'<option value="'+b.v+'">'+b.n+"</option>":'<option value="'+b.n+'">'+b.n+"</option>"}),d},c.buildContent=function(){var b,a=this;a.dom.box.on("change","select",function(){a.selectChange(this.className)}),b=a.getNewOptions(a.dataJson,a.selectArray[0].data("title")),a.selectArray[0].html(b).prop("disabled",!1).trigger("change"),a.setDefaultValue()},c.setDefaultValue=function(a){var b=this;a=a||0,a>=b.selectSum||b.selectArray[a].data("val")&&b.selectArray[a].data("val").length&&setTimeout(function(){b.selectArray[a].val(b.selectArray[a].data("val")).trigger("change"),a++,b.setDefaultValue(a)},1)},c.selectChange=function(a){var b,c,d,e,f,g;for(a=a.replace(/ /g,","),a=","+a+",",b=[],g=0;g<this.selectSum;g++)b.push(this.getIndex(this.selectArray[g].get(0).selectedIndex)),"number"==typeof c&&g>c&&(this.selectArray[g].empty().prop("disabled",!0),"none"===this.settings.nodata?this.selectArray[g].css("display","none"):"hidden"===this.settings.nodata&&this.selectArray[g].css("visibility","hidden")),a.indexOf(","+this.settings.selects[g]+",")>-1&&(c=g);for(d=c+1,e=this.dataJson,g=0;d>g;g++){if("undefined"==typeof e[b[g]]||this.isArray(e[b[g]].s)===!1||!e[b[g]].s.length)return;e=e[b[g]].s}this.selectArray[d]&&(f=this.getNewOptions(e,this.selectArray[d].data("title")),this.selectArray[d].html(f).prop("disabled",!1).css({display:"",visibility:""}).trigger("change"))},c.init()},a.cxSelect={defaults:{selects:[],url:null,nodata:null,required:!1,title:"请选择"}}}(jQuery);